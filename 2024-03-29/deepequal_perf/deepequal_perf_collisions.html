<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Plot</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uplot@1.6.30/dist/uPlot.min.css" />
<script type="module">import uplot from 'https://cdn.jsdelivr.net/npm/uplot@1.6.30/+esm';
window.data = [{"opts":{"title":"deep equal runtime comparison","class":"uplot-chart","width":1800,"height":700,"focus":{"alpha":0.1},"cursor":{"focus":{"prox":5},"drag":{"x":true}},"scales":{"x":{"time":false}},"series":[{},{"show":true,"spanGaps":true,"label":"builtin","stroke":"red","width":1},{"show":true,"spanGaps":true,"label":"deep-equal","stroke":"green","width":1},{"show":true,"spanGaps":true,"label":"deep-equal over builtin","stroke":"blue","width":1}]},"data":[[50,75,113,170,255,383,575,863,1295,1943,2915,4373,6560,9840,14760,22140,33210,49815],[0.567125,0.209958,0.075,0.133083,0.172875,0.228833,0.521458,0.377125,0.341792,0.537,0.593292,1.2145,1.76825,1.975833,2.984375,4.557833,6.766041,10.119292],[6.220292,10.795,16.563167,24.782042,36.437292,54.671917,67.51625,105.397,158.707333,238.922125,359.732167,536.233583,818.126583,1213.706917,1830.764042,2728.543792,4089.131209,6163.636667],[10.968114613180516,51.41504491374465,220.84222666666668,186.21493353771706,210.77247722342733,238.91622711759229,129.475911770459,279.4749751408684,464.3389342055988,444.92015828677836,606.3324079879721,441.52621078633183,462.67585635515337,614.2760633110187,613.4497313507853,598.6493563937073,604.3609858409076,609.0976193789052]],"mappingSX":[null,null,null]}];

// window.data has been seeded above with a json literal: a list of plots to make.
// Also, legendFn has also been surgically injected into window.data.

// set up the uPlot hooks so we can obtain mouse x and s coords, and implement the click event handler.

window.data.forEach((d) => {
  const el = document.createElement("div");
  document.body.appendChild(el);
  let curIdx = null;
  let curSid = null;
  uplot({ ...d.opts, hooks: d.mappingX || d.mappingSX ? {
    setCursor: [(u) => {
      curIdx = u.cursor.idx;
    }],
    setSeries: [(u, sid) => {
      curSid = sid;
    }],
    ready: [(u) => {
      const el = u.over;
      el.addEventListener('click', (e) => {
        // sid will be null unless hovering a datapoint
        if (curSid === null) return;
        // perform mapping
        // console.log(curIdx, curSid, d.mappingX, d.mappingSX);
        let mapping;
        if (d.mappingSX[curSid-1]) {
          mapping = d.mappingSX[curSid-1][curIdx];
          console.log('mapped sx', mapping);
        } else if (d.mappingX) {
          mapping = d.mappingX[curIdx];
          console.log('mapped x', mapping);
        }
        if (mapping) {
          console.log("currently on", location.href, "redirecting to", mapping, `with href suffix translation "${d.targetNavGroupId}"`);
          const targetURL = (d.targetNavGroupId ? location.href.replace(/:%20.*$/, ':%20' + encodeURI(d.targetNavGroupId)) : location.href) + '#' + mapping;
          console.log('targetURL', targetURL);
          location.href = targetURL;
        }
      });
    }],
  } : {}}, d.data, el);
});
</script>
</head><body></body></html>